{% extends "admin/index.html" %}
{% load static dashboard_tags %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* Estilos Dashboard Ejecutivo */
    .dashboard-container { max-width: 1200px; margin: 0 auto; padding-top: 20px; }

    /* Grid de Tarjetas */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .kpi-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        border-top: 4px solid #ccc;
        transition: transform 0.2s;
    }
    .kpi-card:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

    .kpi-title { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 5px; font-weight: 600; }
    .kpi-value { font-size: 26px; font-weight: 700; color: #333; margin-bottom: 5px; }
    .kpi-sub { font-size: 12px; color: #666; }

    /* Colores Sem치nticos */
    .border-green { border-top-color: #10b981; }
    .border-blue { border-top-color: #3b82f6; }
    .border-red { border-top-color: #ef4444; }
    .border-purple { border-top-color: #8b5cf6; }

    .text-green { color: #10b981; }
    .text-red { color: #ef4444; }

    /* Secci칩n de Gr치fico */
    .chart-section {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .chart-title { font-size: 16px; font-weight: bold; color: #444; margin: 0; }
</style>
{% endblock %}

{% block content %}
{% get_dashboard_stats as stats %}

<div class="dashboard-container">
    <div class="kpi-grid">
        <div class="kpi-card border-green">
            <div class="kpi-title">Liquidez Total</div>
            <div class="kpi-value text-green">$ {{ stats.liquidez|floatformat:0 }}</div>
            <div class="kpi-sub">Caja + Bancos</div>
        </div>

        <div class="kpi-card border-blue">
            <div class="kpi-title">Ventas del Mes</div>
            <div class="kpi-value">$ {{ stats.ventas_mes|floatformat:0 }}</div>
            <div class="kpi-sub">Facturaci칩n Bruta</div>
        </div>

        <div class="kpi-card border-purple">
            <div class="kpi-title">Por Cobrar</div>
            <div class="kpi-value">$ {{ stats.a_cobrar|floatformat:0 }}</div>
            <div class="kpi-sub">
                Cheques: ${{ stats.cheques_cartera|floatformat:0 }}
            </div>
        </div>

        <div class="kpi-card border-red">
            <div class="kpi-title">Por Pagar</div>
            <div class="kpi-value text-red">$ {{ stats.a_pagar|floatformat:0 }}</div>
            <div class="kpi-sub">Proveedores</div>
        </div>
    </div>

    <div class="chart-section">
        <div class="chart-header">
            <h2 class="chart-title">游늳 Evoluci칩n de Ventas (Este Mes)</h2>
        </div>
        <div style="height: 300px; width: 100%;">
            <canvas id="salesChart"></canvas>
        </div>
    </div>

    {{ block.super }}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('salesChart').getContext('2d');

        // Datos inyectados desde Django
        const labels = {{ stats.chart_labels|safe }};
        const data = {{ stats.chart_data|safe }};

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Ventas ($)',
                    data: data,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 2,
                    tension: 0.4, // Curva suave
                    fill: true,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#3b82f6',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return '$ ' + context.parsed.y.toLocaleString('es-AR');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { borderDash: [2, 4], color: '#f0f0f0' },
                        ticks: {
                            callback: function(value) { return '$' + value.toLocaleString('es-AR'); }
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    });
</script>
{% endblock %}